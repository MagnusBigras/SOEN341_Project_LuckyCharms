@page
@model Lucky_Charm_Event_track.Pages.StudentFeedbackModel
@{
    ViewData["Title"] = "Student Feedback";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/studentportal.css">
    <link rel="stylesheet" href="~/css/site.css">
    <style>
        form {
            background-color: #fff;
            padding: 25px 30px;
            border-radius: 12px;
            max-width: 950px;
            margin-left: 2rem;
        }

        form label {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        form input[type="number"],
        form select,
        form textarea {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }

        form input[type="number"] {
            max-width: 100px;
        }

        form textarea {
            min-height: 80px;
            resize: vertical;
        }

        form button[type="submit"] {
            background-color: #912338;
            color: #fff;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        form button[type="submit"]:hover {
            background-color: rgb(188, 45, 71);
        }
    </style>
</head>
<body>
<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-menu">
        <div class="sidebar-item">
            <a asp-page="/StudentsEventsOffered" class="sidebar-link">
                <img src="~/Images/Untitled design (1)-Photoroom.png" class="sidebar-icon" alt="EventsOffered">
                <span class="sidebar-text">Events Offered</span>
            </a>
        </div>
        <div class="sidebar-item">
            <a asp-page="/StudentsMyTickets" class="sidebar-link">
                <img src="~/Images/86c1865905340afb06ee2948873e0be24974cff4.png" class="sidebar-icon" alt="Events">
                <span class="sidebar-text">Tickets</span>
            </a>
        </div>
        <div class="sidebar-item">
            <a asp-page="/StudentFeedback" class="sidebar-link active">
                <img src="~/Images/2508862806f0dced98f9ab1e25e74ce54c4711b2.png" class="sidebar-icon" alt="Feedback">
                <span class="sidebar-text">Feedback</span>
            </a>
        </div>
        <div class="sidebar-item" id="sidebarCreate">
            <a asp-page="/StudentsMyCalendar" class="sidebar-link">
                <img src="~/Images/Untitled design-Photoroom.png" class="sidebar-icon" alt="Calendar">
                <span class="sidebar-text">Calendar</span>
            </a>
        </div>
        <div class="sidebar-bar"></div>
        <div class="sidebar-extra">
            <div class="sidebar-item">
                <img src="~/Images/7965593328e6cb27ffb10553f680443da25fad1a.png" class="sidebar-icon" alt="Organization Settings">
                <span class="sidebar-text">Organization Settings</span>
            </div>
            <div class="sidebar-item" id="logoutBtn" style="cursor:pointer;">
                <img src="~/Images/af7e2a95556abcf8c3cc0c41fedea581cd0f43af.png" class="sidebar-icon" alt="Sign out">
                <span class="sidebar-text">Sign out</span>
            </div>
        </div>
        <div class="sidebar-contact">
            <div class="sidebar-item">
                <img src="~/Images/Untitled%20design.png" class="sidebar-icon" alt="Contact">
                <span class="sidebar-text">Contact</span>
            </div>
        </div>
    </div>
</div>

<!-- Top Navbar -->
<div class="top-navbar">
    <div class="navbar-left">
        <img src="~/Images/Green%20Classic%20Four%20Leaf%20Clover%20Geometric%20Logo.png" alt="Logo" class="logo">
    </div>
    <div class="navbar-right">
        <img src="https://icons.veryicon.com/png/o/miscellaneous/250-thick-line-icon-of-website-and-app/6-bell.png" alt="Notifications" class="bell-icon">
        <button class="account-btn">
            <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="User Avatar" class="account-img">
            <span class="account-name">@Model.FirstName</span>
        </button>
    </div>
</div>

<div class="main-content">
    <div class="main-content-header">
        <h1>Feedback</h1>
    </div>

    <form method="post" asp-page-handler="SubmitReview">
        <div>
            <label>Select Event:</label>
            <select asp-for="Review.EventID" required>
                <option value="">-- Select an Event --</option>
                @foreach (var ev in Model.UserEvents)
                {
                    <option value="@ev.Id">@ev.EventName</option>
                }
            </select>
        </div>

        <div>
            <label>Overall Experience (1-5)</label>
            <input type="number" asp-for="Review.OverallExperience" min="1" max="5" required />
        </div>

        <div>
            <label>Likelihood to Recommend (1-5)</label>
            <input type="number" asp-for="Review.LikehoodToRecommendTheEvent" min="1" max="5" required />
        </div>

        <div>
            <label>Did the event meet expectations?</label>
            <select asp-for="Review.DidTheEventMeetExpectations">
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Somewhat">Somewhat</option>
            </select>
        </div>

        <div>
            <label>Was the event worth the cost?</label>
            <select asp-for="Review.WasTheEventWorthTheCost">
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Somewhat">Somewhat</option>
            </select>
        </div>

        <div>
            <label>Ease of Check-in (1-5)</label>
            <input type="number" asp-for="Review.EaseOfCheckinRanking" min="1" max="5" />
        </div>

        <div>
            <label>Satisfaction with Venue (1-5)</label>
            <input type="number" asp-for="Review.SatisfactionRankingForVenue" min="1" max="5" />
        </div>

        <div>
            <label>Staff Ranking Score (1-5)</label>
            <input type="number" asp-for="Review.StaffRankingScore" min="1" max="5" />
        </div>

        <div>
            <label>What can be improved?</label>
            <textarea asp-for="Review.WhatCanBeImproved"></textarea>
        </div>

        <div>
            <label>Additional Comments</label>
            <textarea asp-for="Review.AdditionalComments"></textarea>
        </div>

        <button type="submit" @(Model.UserEvents.Count == 0 ? "disabled" : "")>
            Submit Feedback
        </button>
        <p style="color:red;" @(Model.UserEvents.Count > 0 ? "hidden" : "")>
            
            You can only submit feedback for events that have already occurred.
        </p>
    </form>
</div>


<script>
document.getElementById("logoutBtn")?.addEventListener("click", async () => {
    try {
        const response = await fetch("/api/accounts/logout", { method: "POST" });
        if (response.ok) {
            const result = await response.json();
            alert(result.message);
            window.location.href = result.redirectUrl; 
        } else {
            alert("Failed to sign out. Please try again.");
        }
    } catch (err) {
        console.error("Logout error:", err);
        alert("An error occurred during sign out.");
    }
});
</script>


</body>
</html>
