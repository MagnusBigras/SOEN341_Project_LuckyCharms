@page
@model Lucky_Charm_Event_track.Pages.StudentsEventsOfferedModel
@{
    ViewData["Title"] = "StudentsEventsOffered";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/studentportal.css">
</head>
<body>

<!-- Sidebar navigation -->
<div class="sidebar">
    <div class="sidebar-menu">

        <div class="sidebar-item">
            <a asp-page="/StudentsEventsOffered" class="sidebar-link">
                <img src="~/Images/Untitled design (1)-Photoroom.png" class="sidebar-icon" alt="EventsOffered">
                <span class="sidebar-text">Events Offered</span>
            </a>
        </div>

        <!-- Feedback section -->
        <div class="sidebar-item">
            <img src="~/Images/2508862806f0dced98f9ab1e25e74ce54c4711b2.png" class="sidebar-icon" alt="Feedback">
            <span class="sidebar-text">Feedback</span>
        </div>

        <!-- Calendar -->
        <div class="sidebar-item" id="sidebarCreate">
         <a asp-page="/StudentsMyCalendar" class="sidebar-link">
            <img src="~/Images/Untitled design-Photoroom.png" class="sidebar-icon" alt="Calendar">
            <span class="sidebar-text">Calendar</span>
            </a>
        </div>

        <!-- Divider bar -->
        <div class="sidebar-bar"></div>

        <!-- Extra sidebar items like settings and sign out -->
        <div class="sidebar-extra">
            <div class="sidebar-item">
                <img src="~/Images/7965593328e6cb27ffb10553f680443da25fad1a.png" class="sidebar-icon" alt="Organization Settings">
                <span class="sidebar-text">Organization Settings</span>
            </div>
            <div class="sidebar-item">
                <img src="~/Images/af7e2a95556abcf8c3cc0c41fedea581cd0f43af.png" class="sidebar-icon" alt="Sign out">
                <span class="sidebar-text">Sign out</span>
            </div>
        </div>

        <!-- Contact info in sidebar -->
        <div class="sidebar-contact">
            <div class="sidebar-item">
                <img src="~/Images/Untitled%20design.png" class="sidebar-icon" alt="Contact">
                <span class="sidebar-text">Contact</span>
            </div>
        </div>
    </div>
</div>

<!-- Top navigation bar -->
<div class="top-navbar">
    <div class="navbar-left">
        <img src="~/Images/Green%20Classic%20Four%20Leaf%20Clover%20Geometric%20Logo.png" alt="Logo" class="logo">
    </div>
    <div class="navbar-right">
        <img src="https://icons.veryicon.com/png/o/miscellaneous/250-thick-line-icon-of-website-and-app/6-bell.png"
             alt="Notifications"
             class="bell-icon">
        <button class="account-btn">
            <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="User Avatar" class="account-img">
            <span class="account-name">Alex</span>
        </button>
    </div>
</div>

<!-- Main content area -->
<div class="main-content">
    <div class="main-content-header">
        <h1>Events Offered</h1>
    </div>

    <!-- Search and Sort Bar -->
    <form method="get" class="search-sort-bar">
        <input type="text" name="SearchQuery" placeholder="Search events..." value="@Model.SearchQuery" />

        <select name="SortByDate">
            <option value="">Sort by Date</option>
            <option value="asc" selected="@(Model.SortByDate=="asc" ? "selected" : null)">Earliest First</option>
            <option value="desc" selected="@(Model.SortByDate=="desc" ? "selected" : null)">Latest First</option>
        </select>

        <select name="SortByPrice">
            <option value="">Sort by Price</option>
            <option value="asc" selected="@(Model.SortByPrice=="asc" ? "selected" : null)">Low to High</option>
            <option value="desc" selected="@(Model.SortByPrice=="desc" ? "selected" : null)">High to Low</option>
        </select>

        <select name="SortByPopularity">
            <option value="">Sort by Popularity</option>
            <option value="asc" selected="@(Model.SortByPopularity=="asc" ? "selected" : null)">Least to Most</option>
            <option value="desc" selected="@(Model.SortByPopularity=="desc" ? "selected" : null)">Most to Least</option>
        </select>

        <!-- Filter by Category -->
        <select id="category" name="Category">
            <option value="">All Categories</option>
            <option value="meeting" selected="@(Model.Category=="meeting" ? "selected" : null)">Meeting</option>
            <option value="workshop" selected="@(Model.Category=="workshop" ? "selected" : null)">Workshop</option>
            <option value="conference" selected="@(Model.Category=="conference" ? "selected" : null)">Conference</option>
            <option value="social" selected="@(Model.Category=="social" ? "selected" : null)">Social Gathering</option>
            <option value="other" selected="@(Model.Category=="other" ? "selected" : null)">Other</option>
        </select>

        <!-- Filter by Organization -->
        <select name="Organization">
            <option value="">All Organizations</option>
            @foreach (var org in Model.AllOrganizations)
            {
                <option value="@org" selected="@(Model.Organization==org ? "selected" : null)">@org</option>
            }
        </select>

        <!-- Filter by Location -->
        <select name="Location">
            <option value="">All Locations</option>
            @foreach (var loc in Model.AllLocations)
            {
                <option value="@loc" selected="@(Model.Location==loc ? "selected" : null)">@loc</option>
            }
        </select>

        <!-- Filter by Price Range -->
        <input type="number" name="MinPrice" placeholder="Min Price" value="@(Model.MinPrice?.ToString() ?? "")" min="0" />
        <input type="number" name="MaxPrice" placeholder="Max Price" value="@(Model.MaxPrice?.ToString() ?? "")" min="0" />

        <button type="submit">Apply</button>
    </form>

    <!-- Events Grid -->
    @if (!Model.FilteredEvents.Any())
    {
        <p class="no-events">No events match your search or filter criteria.</p>
    }
    else
    {
        <div class="event-grid">
            @foreach (var e in Model.FilteredEvents)
            {
                <div class="event-card">
                    <h3>@e.Name</h3>
                    <p><strong>Date:</strong> @e.Date</p>
                    <p><strong>Location:</strong> @e.Location</p>
                    <p><strong>Price:</strong> @(e.Price == 0 ? "Free" : "$" + e.Price)</p>

                    <div class="event-card-buttons">
                        <button class="details-btn"
                            onclick="openEventsOfferedPopup('@e.Name', '@e.Date', '@e.startTime', '@e.endTime', '@e.Location', '@(e.Price == 0 ? "Free" : "$" + e.Price)', '@e.Description', '@e.TicketsLeft', '@e.Category', '@e.Organization')">
                            View Details
                        </button>

                        <button class="purchase-btn" onclick="alert('Tickets claimed for @e.Name')">
                            @(e.Price == 0 ? "Claim Ticket" : "Purchase Ticket")
                        </button>
                    </div>
                </div>
            }
        </div>
    }
</div>

<!-- Events Offered Popup -->
<div id="eventsOfferedPopup" class="events-offered-popup">
    <div class="events-offered-popup-content">
        <span class="events-offered-close-btn" onclick="closeEventsOfferedPopup()">&times;</span>
        <h2 id="eventsOfferedName"></h2>
        <p><strong>Date:</strong> <span id="eventsOfferedDate"></span></p>
        <p><strong>Start:</strong> <span id="eventsOfferedStart"></span></p>
        <p><strong>End:</strong> <span id="eventsOfferedEnd"></span></p>
        <p><strong>Location:</strong> <span id="eventsOfferedLocation"></span></p>
        <p><strong>Price:</strong> <span id="eventsOfferedPrice"></span></p>
        <p><strong>Description:</strong> <span id="eventsOfferedDescription"></span></p>
        <p><strong>Tickets Left:</strong> <span id="eventsOfferedTickets"></span></p>
        <p><strong>Category:</strong> <span id="eventsOfferedCategory"></span></p>
        <p><strong>Organization:</strong> <span id="eventsOfferedOrganization"></span></p>
    </div>
</div>

<!-- Scripts -->
<script>
    function openEventsOfferedPopup(name, date, start, end, location, price, description, tickets, category, organization) {
        document.getElementById('eventsOfferedName').innerText = name;
        document.getElementById('eventsOfferedDate').innerText = date;
        document.getElementById('eventsOfferedStart').innerText = start || "N/A";
        document.getElementById('eventsOfferedEnd').innerText = end || "N/A";
        document.getElementById('eventsOfferedLocation').innerText = location;
        document.getElementById('eventsOfferedPrice').innerText = price;
        document.getElementById('eventsOfferedDescription').innerText = description;
        document.getElementById('eventsOfferedTickets').innerText = tickets;
        document.getElementById('eventsOfferedCategory').innerText = category;
        document.getElementById('eventsOfferedOrganization').innerText = organization;

        document.getElementById('eventsOfferedPopup').style.display = 'block';
    }

    function closeEventsOfferedPopup() {
        document.getElementById('eventsOfferedPopup').style.display = 'none';
    }

    window.onclick = function(event) {
        const popup = document.getElementById('eventsOfferedPopup');
        if (event.target === popup) {
            popup.style.display = 'none';
        }
    }
</script>

</body>
</html>
